import { useForm, Controller } from "react-hook-form";
import { AuthContext } from "../context/AuthContext";
import { useContext } from "react";
import { yupResolver } from "@hookform/resolvers/yup";
import { signInSchema } from "./validationSchemas";
import Select from "../components/select/select";
import Field from "../components/fields/field";
import Button from "../components/buttons/button";
import style from "./style.module.scss";

const defaultValues = {
  userName: "",
  password: "",
};

function SignIn() {
  const { handleSignIn, GetUserData} = useContext(AuthContext);

  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm({
    defaultValues,
    resolver: yupResolver(signInSchema),
  });
  
  const FormInput = (data) => {
    // Формируем объект с данными для отправки на бэкенд
    const formData = {
      login: data.login,
      password: data.password,
    };
    console.log(formData); // Вывод данных для проверки

    if (handleSignIn) {
      handleSignIn(formData)
      .then(()=>
    GetUserData());
    } else {
      console.error("handleSignIn is not defined");
    }
  };
  
  return (
    <div className={`${style.fadeinout} flex w-full h-full flex-col gap-4 bg-[#f9fafb] justify-center items-center content-center pt-6`}>
        <svg xmlns="http://www.w3.org/2000/svg" width="175" height="43" viewBox="0 0 175 43" fill="none">
        <path d="M31.3389 17.68L31.7148 17.996C31.8967 18.1491 31.9434 18.4091 31.8279 18.6157L29.4 22.9203C29.3263 23.0515 29.1838 23.1342 29.0314 23.1342H28.1123C27.8961 23.1342 27.7609 23.3675 27.8715 23.5522L28.1738 24.0578C28.2475 24.1842 28.2524 24.3397 28.1811 24.471L25.7803 28.8509C25.6673 29.0575 25.4485 29.1863 25.2126 29.1863H21.2907C21.0253 29.1863 20.9393 29.5387 21.1752 29.6578L23.3205 30.737C23.6792 30.9193 23.7874 31.3811 23.5392 31.6971C21.7723 33.9526 21.4971 37.1488 24.1977 38.4322C22.5022 36.1085 24.3452 31.2741 28.6161 32.2221C33.7495 33.3596 30.3977 41.8641 25.4608 40.6926C22.8388 40.1336 5.89034 36.4051 3.34697 35.6492C0.754443 34.8811 0.651233 32.4262 0.651233 30.929C0.651233 28.1533 4.79682 20.8592 5.81908 19.1067C5.95915 18.8685 6.21472 18.7227 6.4924 18.7227H7.73829C7.99631 18.7227 8.12655 18.4116 7.94225 18.2293L7.30579 17.6046C7.05268 17.3567 7.00353 16.9703 7.18538 16.6664L8.49024 14.5008C8.70158 14.1484 9.08738 13.9345 9.50268 13.9393L19.9711 14.0341C20.2316 14.0341 20.4625 13.8761 20.5486 13.6331C20.6837 13.2539 20.4085 12.8529 20.003 12.8359C20.003 12.8359 8.96943 12.3813 8.74089 12.3595C5.9911 12.0921 5.04501 10.1331 4.90248 9.02959C4.74767 7.79729 5.78468 5.89902 7.65228 5.13096C9.51988 4.36047 10.3259 6.67923 21.0081 6.48965C24.7875 6.42159 27.2645 6.14451 29.0683 6.09346C29.8988 6.06916 30.3019 7.07541 29.69 7.62958C29.083 8.17646 28.5522 9.01014 28.3286 10.2765C27.7757 13.4241 30.2625 14.5834 31.6485 14.5178C33.2482 14.44 34.8038 12.4664 33.032 10.906C31.8918 9.91432 31.7861 9.12681 32.0368 8.54834C32.4693 7.5591 33.8159 7.41812 34.5384 8.22264C34.9193 8.64556 35.3149 9.19001 35.5557 9.81223C37.5265 14.9237 33.2605 17.0748 31.4322 17.3543C31.2725 17.3786 31.216 17.5779 31.3389 17.6824V17.68Z" fill="black"/>
        <path d="M3.38134 14.8897C3.47964 15.738 2.7842 16.4404 1.69067 16.5619C0.764242 16.664 0 15.8133 0 14.8897C0 13.9661 0.75687 13.2175 1.69067 13.2175C2.62447 13.2175 3.27322 13.9709 3.38134 14.8897Z" fill="black"/>
        <path d="M31.7615 4.70561C32.4618 4.70561 33.0295 4.1441 33.0295 3.45144C33.0295 2.75878 32.4618 2.19727 31.7615 2.19727C31.0612 2.19727 30.4935 2.75878 30.4935 3.45144C30.4935 4.1441 31.0612 4.70561 31.7615 4.70561Z" fill="black"/>
        <path d="M32.0736 27.8786C32.0736 28.7318 31.3733 29.4245 30.5107 29.4245C29.6482 29.4245 28.9478 28.7318 28.9478 27.8786C28.9478 27.0255 30.093 25.4505 30.9555 25.4505C31.8181 25.4505 32.0712 27.0255 32.0712 27.8786H32.0736Z" fill="black"/>
        <path d="M69.976 21.0489C69.976 24.0349 68.976 26.6365 66.9732 28.848L69.3903 31.2969L66.7467 33.6502L64.2329 31.1032C62.2964 32.1995 60.2605 32.7476 58.128 32.7476C54.8628 32.7476 52.0672 31.6186 49.7385 29.3634C47.4319 27.0864 46.2772 24.3158 46.2772 21.0489C46.2772 17.782 47.4319 15.0222 49.7385 12.767C52.0451 10.49 54.8435 9.35013 58.128 9.35013C61.4125 9.35013 64.2108 10.49 66.5174 12.767C68.824 15.0222 69.9787 17.7847 69.9787 21.0489H69.976ZM58.1252 29.1371C59.2992 29.1371 60.4429 28.8917 61.5534 28.3954L57.3738 24.174L60.0175 21.8206L64.3931 26.2356C65.6113 24.733 66.2218 23.0014 66.2218 21.0461C66.2218 18.7473 65.4373 16.8248 63.871 15.2786C62.3047 13.7324 60.3876 12.9579 58.1252 12.9579C55.8628 12.9579 53.9457 13.7324 52.3794 15.2786C50.8131 16.8248 50.0286 18.7473 50.0286 21.0461C50.0286 23.345 50.8131 25.2675 52.3794 26.8137C53.9457 28.3599 55.86 29.1344 58.1252 29.1344V29.1371Z" fill="black"/>
        <path d="M84.5366 24.8503V16.2139H88.0614V32.3277H84.5366V30.2661C83.4482 31.9213 81.7631 32.7476 79.4759 32.7476C77.5836 32.7476 76.0643 32.1504 74.9207 30.9587C73.777 29.767 73.208 28.1499 73.208 26.1074V16.2139H76.7328V25.7529C76.7328 26.9555 77.0588 27.88 77.7107 28.5235C78.3626 29.1671 79.2549 29.4916 80.3875 29.4916C81.672 29.4916 82.683 29.0989 83.4234 28.3163C84.1637 27.5309 84.5338 26.3774 84.5338 24.853L84.5366 24.8503Z" fill="black"/>
        <path d="M107.945 25.7529H94.9509C95.2133 26.9555 95.8045 27.8909 96.7299 28.5562C97.6553 29.2216 98.8017 29.5543 100.175 29.5543C102.025 29.5543 103.429 28.8889 104.387 27.5554L107.293 29.2325C105.705 31.575 103.321 32.7449 100.144 32.7449C97.5116 32.7449 95.3652 31.9513 93.7133 30.3588C92.0807 28.7471 91.2658 26.7183 91.2658 24.2667C91.2658 21.8152 92.0697 19.8735 93.6829 18.2401C95.2713 16.6066 97.3404 15.7913 99.8846 15.7913C102.257 15.7913 104.216 16.6175 105.76 18.2728C107.304 19.9281 108.078 21.9351 108.078 24.2994C108.078 24.7303 108.034 25.213 107.948 25.7502L107.945 25.7529ZM94.9205 22.9169H104.52C104.28 21.6488 103.741 20.6725 102.904 19.9853C102.067 19.2982 101.048 18.9546 99.8514 18.9546C98.5448 18.9546 97.4564 19.3091 96.5862 20.0181C95.7161 20.7271 95.1608 21.6952 94.9205 22.9196V22.9169Z" fill="black"/>
        <path d="M113.691 20.6616C113.691 21.1552 113.954 21.5588 114.476 21.8697C114.998 22.1806 115.76 22.4778 116.76 22.756C117.523 22.9278 118.186 23.1105 118.752 23.3041C119.318 23.4977 119.915 23.7813 120.547 24.1576C121.177 24.534 121.663 25.0275 122 25.6411C122.337 26.2547 122.495 26.9691 122.473 27.7845C122.473 29.3307 121.862 30.5442 120.644 31.425C119.426 32.3058 117.912 32.7476 116.105 32.7476C114.495 32.7476 113.114 32.4149 111.959 31.7495C110.804 31.0842 109.967 30.1597 109.445 28.9789L112.481 27.2391C113.025 28.7853 114.233 29.5598 116.105 29.5598C117.978 29.5598 118.882 28.9571 118.882 27.7545C118.882 26.8737 117.849 26.1865 115.779 25.6929C114.995 25.4993 114.337 25.3057 113.804 25.1121C113.271 24.9185 112.683 24.6403 112.042 24.2749C111.401 23.9095 110.909 23.4268 110.572 22.8241C110.235 22.2242 110.078 21.5234 110.1 20.7298C110.1 19.2463 110.666 18.0546 111.799 17.152C112.951 16.2494 114.379 15.7994 116.075 15.7994C117.423 15.7994 118.628 16.094 119.683 16.6857C120.738 17.2775 121.547 18.0983 122.114 19.1509L119.144 20.7953C118.6 19.5709 117.578 18.9573 116.075 18.9573C115.379 18.9573 114.807 19.1073 114.362 19.4072C113.915 19.7072 113.694 20.1272 113.694 20.6644L113.691 20.6616Z" fill="black"/>
        <path d="M134.028 16.2139V19.5654H129.981V27.2991C129.981 27.9645 130.133 28.4444 130.437 28.7335C130.741 29.0226 131.194 29.1835 131.79 29.2162C132.39 29.2489 133.133 29.2434 134.028 29.1998V32.3249C131.329 32.6467 129.393 32.4149 128.216 31.6323C127.042 30.8469 126.453 29.4043 126.453 27.2964V19.5627H123.451V16.2112H126.453V11.6981H129.978V16.2112H134.025L134.028 16.2139Z" fill="black"/>
        <path d="M137.393 24.8503V9.76736H141.147V24.6239C141.147 26.0202 141.567 27.1219 142.404 27.9263C143.241 28.7308 144.456 29.1344 146.044 29.1344C147.633 29.1344 148.846 28.7308 149.685 27.9263C150.522 27.1219 150.942 26.0202 150.942 24.6239V9.76736H154.696V24.8503C154.696 27.2364 153.89 29.1589 152.279 30.6178C150.691 32.0359 148.611 32.7449 146.044 32.7449C143.478 32.7449 141.398 32.0359 139.81 30.6178C138.199 29.1562 137.393 27.2337 137.393 24.8503Z" fill="black"/>
        <path d="M159.003 9.76736H167.425C169.58 9.76736 171.376 10.4764 172.812 11.8944C174.271 13.3124 175 15.0741 175 17.1793C175 19.2845 174.271 21.0243 172.812 22.4642C171.354 23.904 169.58 24.5912 167.425 24.5912H162.757V32.3249H159.003V9.76736ZM162.757 21.1116H167.425C168.536 21.1116 169.45 20.7407 170.169 19.999C170.887 19.2573 171.246 18.3192 171.246 17.1793C171.246 16.0394 170.887 15.1013 170.169 14.3596C169.45 13.6179 168.536 13.247 167.425 13.247H162.757V21.1116Z" fill="black"/>
      </svg>
    <div className={` flex w-full h-full flex-col gap-4 bg-[#f9fafb] justify-center items-center content-center`}>
      
    <h2 className="text-2xl font-medium ">Войти в аккаунт</h2>
    
    <form className="flex w-96 flex-col gap-2 justify-center items-center content-center p-6 rounded-2xl " onSubmit={handleSubmit(FormInput)} >
      
      <Field
        name="login"
        register={register}
        autoComplete="off"
        placeholder="Имя пользователя"
        error={Boolean(errors.userName)}
        helperText={errors.userName?.message}
      />
      <Field
        name="password"
        register={register}
        autoComplete="off"
        placeholder="Пароль"
        error={Boolean(errors.password)}
        helperText={errors.password?.message}
      />
     <Button disabled={isSubmitting} type="submit">
        Войти
      </Button>
    </form>
    <span className="w-96 text-sm text-gray-400 text-center">Для получения логина и пароля обратитесь <br />к преподавателю</span>
    </div>
    </div>
  );
}

export { SignIn };
